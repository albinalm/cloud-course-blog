---
layout: post
title: Cloud based file storage
date: 2021-09-30 17:00 -0400
subtitle: Storing files in blobs? Uh...
categories: [Assignments, Azure, Storage]
background: '/img/posts/files_cloud/banner.jpg'
---
<head>
    <link rel="shortcut icon" type="image/x-icon" href="https://techshelter.albin.dev/favicon.png">
</head>

<h1>Introduction</h1>
<h3>What is an Azure Blob?</h3>
<p>
    Well to keep it short, an Azure blob is basically a literal big blob of data.
    It can be several files or just one file. You can then read the bytes of the blob to a new file or write additional bytes to the blob.

    The pros of a blob is mnany, but one of them is that it's quite simple in  it's design. It does not use any fancy standards like POSIX and thus the straightforward design makes it simple to extend, but also simple to use on several platforms.<br>
    A blob is most often used to store non-structured data such as multimedia, but honestly you can also use it to store variables or any other data. So it's quite flexible.<br><br>
    But since you may wish to use blobs for different reasons there are actually three types of blobs that are optimized for a specific use.
    <ul>
        <li><strong>Block blob:</strong> A block blob is a blob, but it's been thrown in a dice cutter and consist of several blocks forming your blob. This type of blob is optimized for file sharing</li>
        <li><strong>Page blob:</strong> A page blob is kind of different. It instead using pages that each consist of 512 bytes. This type of blob is optimized for storing your databases or partitions for your VM.</li>
        <li><strong>Append blob:</strong> An append blob works the same as a block blob, but as the name implies you primarily use it to append additional data. Therefore you are unable to update existing data nor deletion. An append blob can hold slightly more data than the previous types. It's optimized for uses when you continously wish to add data.</li>
    </ul>
    For this blog post I made a console application to manage Azure Blobs using a CLI(Command line interface) together with a classmate Robin Axelsson with pair programming. The repository can be found here.
</p>
<h2>Making the app</h2><br>
<h5>Tools needed:</h5>
<p><ul>
    <li>Visual Studio Code</li>
    <li>Azure Storage Account</li>
    <li>Azure Storage Container</li>
    <li>GitHub Account</li>
</ul></p>
<h5>Dependencies needed:</h5>
<p><ul>
    <li>Azure Storage Blobs</li>
    <li>CommandLineParser</li>
    <li>NetEscapades Configuration YAML</li>
    <li>Microsoft Extensions Configuration User secrets</li>
    <li>Microsoft Extensions Configuration Environment variables</li>
    <li>Microsoft Extensions Configuration Commandline</li>
    <li>Microsoft Extensions Configuration(Core lib)</li>
</ul></p>
<h5>Retrieving the configuration</h5>
<img src="https://techshelter.albin.dev/img/posts/files_cloud/01.jpg"> <br>
<p>
    This code can be found in Program.cs and is called on each new instance of the application. By chaining our different configuration sources in this specific order it will let us use several sources in different priority orders.<br>
    For instance the end user can either store the secret connection string in dotnet secrets, or appsettings.yml. But if both exist we will always prioritize the secret.
    This way we can also distinguish testing from live when we develop the application as well which is handy.
</p>
<h5>Using the code</h5>
<p>
    By defining the class <strong>BlobContainerClient</strong> as <i>contaniner</i> null initially and then instantiating it on use we can split our Program.cs into different use cases depending on the core input of the arguments.
    <br>
    All the different input arguments are inherited from an interface we call IOption. Therefore we can firstly make the check if the input match the interface(In other words all valid arguments) and instantiate our container there.
    This saves us some lines of code since we don't have to copy paste the part where we set the container value on every case scenario.<br>
    This alsomakes it easier to expand the application.
    <img src="https://techshelter.albin.dev/img/posts/files_cloud/03.jpg">
    <br><br>
    Now that we have our container client, when we parse the "Add" command we check if the input file exist first by full path, but if that fails we attempt to combine the input URI with the working directory of the app incase you only specify filename and then lastly upload the file to our blob.
    <img src="https://techshelter.albin.dev/img/posts/files_cloud/02.jpg"><br><br>
    The rest of the application is fairly simple IO and string formatting using methods in the BlobClient such as <strong>DeleteBlob, DownloadTo, Upload, CreateIfNotExists.</strong>
    Using Azure Blobs was surprisingly simple only needing a few lines of code to work.
</p>
<h5>Data flow</h5>
<p>
    A blob can contain several <strong>files</strong> and a <strong>Container</strong> can contain several blobs. Lastly a <strong>Storage account</strong> can contain several containers.<br>
    Here is an example how you can separate blobs and containers.
    <img src="https://techshelter.albin.dev/img/posts/files_cloud/04.jpg">
    <br>
</p>
<br>
<br>
<h6>Thank you for reading!</h6>
<p>/Albin</p>
<p><i>Sources:</i></p>
