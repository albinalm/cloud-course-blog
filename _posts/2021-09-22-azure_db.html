---
layout: post
title: A database amongst the clouds
date: 2021-09-22 17:00 -0400
subtitle: Databases can't fly!
categories: [Assignments, Azure, Database]
background: '/img/posts/azure_db/banner.jpg'
---
<head>
    <link rel="shortcut icon" type="image/x-icon" href="https://techshelter.albin.dev/favicon.png">
</head>

<h1>Cloud based database</h1>
<p>For todays post I recently made a quick app to demonstrate how you can use a CosmosDB with Azure together with a REST-API through Azure Functions and automatically deploy using a CI Pipeline.</p>
<h5>How does this app work?</h5>
<p>Well, first of all this wasn't as easy as I first thought. But through some trial and error I managed to get it working with a workflow that I personally I feel is easy to work with.<br>
To do this yourself you will need <a href="https://code.visualstudio.com/" target="_blank" style="color: cornflowerblue !important;">Visual Studio Code</a> together with a few extensions.<br>
<ul>
    <li>
        <a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.azure-account" target="_blank" style="color: cornflowerblue !important;">Azure Account</a><br>
    </li>
    <li>
        <a href="https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-azurefunctions" target="_blank" style="color: cornflowerblue !important;">Azure Functions</a><br>
    </li>
    <li>
        <a href="https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-azureresourcegroups" target="_blank" style="color: cornflowerblue !important;">Azure Resources</a><br>
    </li>
</ul>
<br>
First of all using the Azure extensions, I login and created a Azure function to interact with our database through the GUI in VSCode and used the following settings:
<ol>
    <li><strong>Language: </strong> C#</li>
    <li><strong>.NET Runtime: </strong> 3.1 LTS</li>
    <li><strong>Template: </strong> HTTP Trigger</li>
    <li><strong>Name: </strong>AddAccount</li>
    <li><strong>Namespace: </strong>Privateer.Register</li>
    <li><strong>Auth level: </strong>Anonymous(This lets anyone call my endpoint)</li>
</ol><br>
Afterwards creating the CosmosDB using the same tools with the settings below:
<ol>
    <li><strong>DB Name: </strong>UserDB</li>
    <li><strong>Collection name: </strong>UserCollection</li>
    <li><strong>Parition key: </strong>/id</li>
</ol><br>
Now before proceeding we'll need our ConnectionString as a variable. This can be copied by right clicking your database in the VSCode GUI. Since we'll initially run our function locally we'll need to store the data in <i>local.settings.json</i>. This will later be stored in Azure as a secret once we commit. <br>
<strong>ATT:</strong> Make sure this file is ignored in Git.<br>
<span style="color: white !important; background-color: gray !important;"><i>"DatabaseString": "AccountEndpoint=ireallylovecookies/;AccountKey=noreallycookiesareamazing.it'saworkofartandwhoevercameupwithitisreallyageniousandwehavehimtothankforeternity."</i></span><br>
Here's an image to demonstrate.<br>
<img src="https://techshelter.albin.dev/img/posts/cosmosdb/01.jpg"><br>
<br>
<strong>Great!</strong> I now had a working database and a function to work with. Now I just need these two interacting with eachother. Naturally the function should be the extroverted one and take contact with the database, so hopping on AddAccount.cs and starting coding was the next step.<br>
The function I had was a good starting template, but useless in my case. Following the Microsoft excercise I added below code to quickly create a document in my database:
<br>
<img src="https://techshelter.albin.dev/img/posts/cosmosdb/02.jpg"><br>
<i>This just simply adds a document in JSON format containing a random "Account ID" and the ID of the document itself. The thought here was having each Privateer account have a unique ID connected to their account and authorize using that instead of credentials. Inspiration taken from the VPN app "Mullvad".<br>
Although I will be using SQL for this in the future instead.</i>




</p>

<br>
<br>
<h6>Thank you for reading!</h6>
<p>/Albin</p>
<p><i>Sources:</i></p>